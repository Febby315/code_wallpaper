<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>全功能视屏播放器 By Febby315</title>
    <script src="//cdn.bootcss.com/vue/2.5.16/vue.min.js"></script>
    <script src="//cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <link href="//cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.min.css" rel="stylesheet">
    <script src="//cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="//cdn.bootcss.com/purl/2.3.1/purl.min.js"></script>
    <!-- player -->
    <script src="//cdn.bootcss.com/hls.js/0.9.1/hls.min.js"></script>
    <script src="//cdn.bootcss.com/flv.js/1.4.2/flv.min.js"></script>
    <script src="//imgcache.qq.com/open/qcloud/video/vcplayer/TcPlayer-2.2.1.js"></script>
    <link href="//g.alicdn.com/de/prismplayer/2.6.0/skins/default/aliplayer-min.css"  rel="stylesheet"/>
    <script src="//g.alicdn.com/de/prismplayer/2.6.0/aliplayer-min.js"></script>
    <link href="./css/style.css" rel="stylesheet">
    <style>
        .playerbox{ width: 50%;height: 50%; position: absolute; }
        .playerbox .button{width: 100%; position: absolute; top:0px; text-align: right; z-index: 100; }
        .video{ background: #000; }
    </style>
</head>

<body>
    <div id="body">
        <div style="text-align:center; color:#FAFAFA;">
            <input type="text" v-model="url" placeholder="请输入播放链接..." style="width:100%">
            <input type="button" value="播放" @click="play">
            视频:支持http协议(m3u8/flv/mp4/webp/ogg/ogv)/rtmp协议(flv/f4v)
            <!-- /rtsp协议(ts/mp4)/socket -->
        </div>
        <div v-for="item,k in list" :id="item.id" ref="p" class="playerbox" v-key="k" @click="setTop(item)" @mouseover="item.butShow=true" @mouseout="item.butShow=false">
            <div class="button" v-show="item.butShow">
               <input type="button" value="X" @click="del(item)">
            </div>
            <div :id="'d_'+item.id" class="video" style="width: 100%;height: 100%; display:none;" autoplay controls></div>
            <video ref="v" class="video" style="width: 100%;height: 100%;" autoplay controls>
                <source v-bind:src="item.url" :type="item.type||'video/mp4'">
            </video>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            var v_body = new Vue({
                el: "#body",
                data: {
                    list:[],
                    mp4: "http://112.253.22.160/10/y/x/k/l/yxklhiqyketcuwmntrsevpoggmhfkn/hc.yinyuetai.com/7B360162F1E5670C8FAFC88D480F49E2.mp4",
                    ogg: "http://www.runoob.com/try/demo_source/mov_bbb.ogg",
                    ogv:"https://www.quirksmode.org/html5/videos/big_buck_bunny.ogv",
                    webp: "https://www.quirksmode.org/html5/videos/big_buck_bunny.webm",
                    m3u8: "http://proxy.hls.yy.com/livesystem/15013_xv_50859655_50859655_0_100_0-15013_xa_50859655_50859655_0_100_0.m3u8?org=yyweb&uuid=44416323bd80444db22a35cd0b18dd7b&http://220.194.227.44:8469/15013_xv_22490906_22490906_0_0_0-15013_xa_22490906_22490906_0_0_0-0-0.m3u8?uuid=11d26c3f24b74ae48016169f8236e62a&org=yyweb&m=157248cbcbd4abee38a30a54c596e58d&r=1384112878&v=1&t=1524646147&uid=0t=1524645906&tk=e2d2f57f7b06519d0fe947334cf8ec2d",
                    flv: "http://hls.yy.com/newlive/54880976_54880976.flv?org=yyweb&appid=0&uuid=dea3deafb58b49669b6a2e7319340688&t=1524646353&tk=780ff094e2dce9afb90aaef55e519727&uid=0&ex_audio=0&ex_coderate=1200&ex_spkuid=0",
                    rtmp:"rtmp://live.hkstv.hk.lxdns.com/live/hks",

                    type:"application/x-mpegURL",
                    url: "rtmp://live.hkstv.hk.lxdns.com/live/hks",
                },
                mounted:function(){
                    this.$nextTick(function(){
                        $(".playerbox").draggable().resizable();   //可任意拖放
                    });
                },
                methods: {
                    play: function () {
                        //flv
                        flvPlayer=function(item,ele){
                            if (flvjs.isSupported()) {
                                var flvPlayer = flvjs.createPlayer({ type: 'flv', url: item.url });
                                flvPlayer.attachMediaElement(ele);
                                flvPlayer.load();
                                flvPlayer.play();
                            }
                        }
                        //m3u8
                        hlsPlayer=function(item,ele){
                            if(Hls.isSupported()) {
                                var hls = new Hls();
                                hls.loadSource(item.url);
                                hls.attachMedia(ele);
                                hls.on(Hls.Events.MANIFEST_PARSED,function() {
                                    ele.play();
                                });
                            }else if (ele.canPlayType('application/vnd.apple.mpegurl')) {
                                ele.src = item.url;
                                ele.addEventListener('canplay',function() {
                                    ele.play();
                                });
                            }
                        }
                        //rtmp
                        rtmpPlayer=function(item,ele){
                            $(ele).remove();
                            $("#d_"+item.id).show();
                            var player = new TcPlayer("d_"+item.id, {
                                rtmp : item.url,
                                autoplay : true,controls:"none",
                                width:"100%", height:"100%",
                                live:true
                            });
                        }
                        //h5
                        h5Player=function(item,ele){
                            ele.src = item.url;
                            ele.play();
                        }
                       
                        _this = this;
                        var item = { id:"v"+_this.list.length, url:_this.url, butShow:false };
                        var protocol = $.url(_this.url).attr("protocol");
                        if(protocol=="rtmp"){
                            item.player = rtmpPlayer;
                        }else if(protocol=="http"||protocol=="https"){
                            switch($.url(_this.url).attr("file").split(".").pop().toLowerCase()){
                                case "webm" :  item.type = "video/webm"; item.player = h5Player; break;
                                case "ogg","ogv" :  item.type = "video/ogg"; item.player = h5Player; break;
                                case "flv" : item.player = flvPlayer; break;
                                case "m3u8" : item.type = "application/x-mpegURL"; item.player = hlsPlayer; break;
                                default  : item.player = h5Player; break;
                            }
                        }
                        _this.list.push(item);
                        _this.$nextTick(function(){
                            $(_this.$refs.p[_this.list.length-1]).draggable().resizable();
                            var vele = _this.$refs.v[_this.list.length-1];
                            item.player(item,vele);
                        });
                    },
                    del:function(item){
                        var index = this.list.indexOf(item);
                        index!=-1?this.list.splice(index,1):null;
                    },
                    setTop:function(item){
                        this.list=this.list.concat(this.list.splice(this.list.indexOf(item),1));
                    }
                }
            });
        });
    </script>
</body>

</html>